# Meethub后端 - 第四阶段接口功能需求

## 一、概述

本阶段主要实现活动管理和报名管理相关功能，包括活动的发布、管理、查询，以及用户报名相关的功能。本文档从用户需求出发，详细说明各个功能模块的接口需求。

## 二、功能模块划分

### 1. 活动管理模块
- 活动发布与管理（/activities）
- 活动查询与筛选（/activities/search）
- 活动状态维护（/activities/{id}/status）
- 活动统计功能（/activities/statistics）

### 2. 报名管理模块
- 活动报名（/registrations）
- 报名状态管理（/registrations/{id}/status）
- 报名记录查询（/registrations/records）

### 3. 文件上传模块
- 图片上传（/uploads/images）
- 文件管理（/uploads/files）

## 三、详细功能需求

### 1. 活动管理模块

#### 1.1 活动发布功能
- **接口路径**：POST /activities
- **功能描述**：
  - 创建新的活动
  - 支持设置活动基本信息
  - 支持上传活动封面图
  - 支持设置活动标签和分类
- **权限要求**：需要活动发布权限
- **业务规则**：
  - 活动时间必须大于当前时间
  - 招募人数必须大于0
  - 必须包含基本的活动信息（标题、时间、地点等）
  - 活动发布后状态为"待审核"

#### 1.2 活动查询功能
- **接口路径**：GET /activities/search
- **功能描述**：
  - 支持多条件组合查询
  - 支持分页获取活动列表
  - 支持按热度排序
  - 支持按时间排序
- **查询条件支持**：
  - 活动名称关键字
  - 活动类型
  - 活动时间范围
  - 活动状态
  - 专业要求
  - 年级要求
- **特殊功能**：
  - 支持获取推荐活动
  - 支持获取最新活动
  - 支持获取热门活动

#### 1.3 活动详情功能
- **接口路径**：GET /activities/{id}
- **功能描述**：
  - 获取活动完整信息
  - 包含报名统计信息
  - 包含活动状态信息
- **附加功能**：
  - 记录活动浏览量
  - 获取相关推荐活动

#### 1.4 活动管理功能
- **接口路径**：
  - PUT /activities/{id}（更新活动）
  - DELETE /activities/{id}（删除活动）
  - PATCH /activities/{id}/status（更新状态）
- **功能描述**：
  - 修改活动信息
  - 更新活动状态
  - 删除活动
- **权限控制**：
  - 仅活动发布者可修改
  - 管理员可以审核和删除
  - 不同状态有不同的可修改字段

### 2. 报名管理模块

#### 2.1 活动报名功能
- **接口路径**：POST /registrations
- **功能描述**：
  - 用户报名活动
  - 填写报名信息
  - 获取报名确认
- **业务规则**：
  - 检查活动报名人数限制
  - 检查用户是否符合报名条件
  - 防止重复报名
  - 支持取消报名

#### 2.2 报名记录管理
- **接口路径**：
  - GET /registrations/my（获取个人报名记录）
  - GET /registrations/activity/{id}（获取活动报名记录）
- **功能描述**：
  - 查看个人报名历史
  - 查看活动报名情况
  - 管理报名状态
- **数据展示**：
  - 报名时间
  - 报名状态
  - 活动信息
  - 报名详情

#### 2.3 报名状态管理
- **接口路径**：PATCH /registrations/{id}/status
- **功能描述**：
  - 更新报名状态
  - 处理报名审核
  - 管理报名流程
- **状态流转**：
  - 待审核 → 已通过/已拒绝
  - 已通过 → 已参加/未参加
  - 支持取消报名

### 3. 文件上传模块

#### 3.1 图片上传功能
- **接口路径**：POST /uploads/images
- **功能描述**：
  - 上传活动封面图
  - 上传用户头像
- **技术要求**：
  - 支持图片格式验证
  - 支持图片大小限制
  - 支持图片压缩
  - 返回图片访问URL

#### 3.2 文件管理功能
- **接口路径**：
  - GET /uploads/files（获取文件列表）
  - DELETE /uploads/files/{id}（删除文件）
- **功能描述**：
  - 管理已上传文件
  - 删除无用文件
  - 查看文件使用情况

## 四、接口响应规范

### 1. 成功响应格式
```json
{
  "success": true,
  "data": {
    // 具体的响应数据
  },
  "message": "操作成功描述"
}
```

### 2. 错误响应格式
```json
{
  "success": false,
  "error": {
    "code": "错误代码",
    "message": "错误描述"
  }
}
```

### 3. 分页响应格式
```json
{
  "success": true,
  "data": {
    "items": [],
    "total": 0,
    "page": 1,
    "page_size": 10
  }
}
```

## 五、权限控制要求

### 1. 活动管理权限
- 活动发布：需要发布权限
- 活动修改：发布者或管理员
- 活动删除：发布者或管理员
- 活动查询：所有用户

### 2. 报名管理权限
- 报名操作：登录用户
- 查看报名：活动发布者或报名用户
- 报名审核：活动发布者
- 取消报名：报名用户

### 3. 文件管理权限
- 文件上传：登录用户
- 文件删除：文件上传者或管理员
- 文件查看：根据文件类型判断

## 六、开发优先级建议

### 第一阶段：基础活动功能
1. 活动发布和查询接口
2. 文件上传接口
3. 活动详情查看

### 第二阶段：报名功能
1. 活动报名接口
2. 报名记录查询
3. 报名状态管理

### 第三阶段：高级功能
1. 活动推荐功能
2. 统计分析功能
3. 活动状态流转
4. 报名审核流程

### 第四阶段：优化和完善
1. 搜索功能优化
2. 性能优化
3. 用户体验改进
4. 异常处理完善

## 七、注意事项

### 1. 数据一致性
- 活动人数和实际报名人数的一致性
- 活动状态和报名状态的同步
- 文件引用关系的维护

### 2. 性能考虑
- 活动列表的分页查询
- 文件上传的异步处理
- 热门活动的缓存策略

### 3. 安全措施
- 文件上传的安全验证
- 用户权限的严格控制
- 敏感信息的保护

### 4. 用户体验
- 友好的错误提示
- 合理的状态反馈
- 及时的操作响应